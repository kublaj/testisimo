var t,e;!function(){function t(t){t.onerror=function(t,e,n,s,o){testisimo?testisimo.error(o||t,e,n,s):i.push({error:o||t,file:e,line:n,column:s})}}function e(){0===s&&setTimeout(function(){for(;o.length;)o[0](),o.shift()},100)}function n(){}var s,o,i=[];t(window),s=0,o=[],function(t){XMLHttpRequest.prototype.open=function(){s++,this.addEventListener("readystatechange",function(){4===this.readyState&&s--,0>s&&(s=0),e()},!1),t.apply(this,arguments)}}(XMLHttpRequest.prototype.open),n.prototype.selectedClass="testisimo-selected",n.prototype.minStepWait=100,n.prototype.minActionWait=100,n.prototype.waitForElementInterval=250,n.prototype.maxWaitForElementAttempts=8,n.prototype.speed=1,n.prototype.resources={useCDN:!0,fontAwesome:"/3rd-party/font-awesome/css/font-awesome.css",fontAwesomeCDN:"//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css",bootstrap:"/3rd-party/bootstrap/css/bootstrap.min.css",bootstrapCDN:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css",angular:"/3rd-party/angular/angular.min.js",angularCDN:"//ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"},n.prototype.iframeId="testisimo-iframe",n.prototype.waitForAjaxDone=function(t){o.push(t),e()},n.prototype.listeners={_all:[]},n.prototype.addEventListener=function(t,e){1===arguments.length&&(e=arguments[0],t="_all"),this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},n.prototype.removeEventListener=function(t,e){1===arguments.length&&(e=arguments[0],t="_all"),this.listeners[t]=this.listeners[t]||[];var n=this.listeners[t].indexOf(e);n>-1&&this.listeners[t].splice(n,1)},n.prototype.eventsInterceptor=null,n.prototype.emit=function(t,e){var n,s,o;if(!this.silentMode){for(n=this.listeners[t]||[],s=0;s<n.length;s++)this.eventsInterceptor?this.eventsInterceptor(t,e,function(t,e){n[s](e)}):n[s](e);for(o=this.listeners._all,s=0;s<o.length;s++)this.eventsInterceptor?this.eventsInterceptor(t,e,function(t,e){o[s](t,e)}):o[s](t,e)}},n.prototype.addStyles=function(){var t=document.createElement("STYLE");t.id="testisimo-style",t.innerHTML="."+this.selectedClass+" { outline:3px solid orange !important; }#testisimo-overlay { z-index:9998;position:fixed;top:0px;bottom:0px;left:0px;right:0px;cursor:crosshair;opacity:0.2;background: linear-gradient(45deg, rgba(0,0,0,0.0980392) 25%, rgba(0,0,0,0) 25%, rgba(0,0,0,0) 75%, rgba(0,0,0,0.0980392) 75%, rgba(0,0,0,0.0980392) 0), linear-gradient(45deg, rgba(0,0,0,0.0980392) 25%, rgba(0,0,0,0) 25%, rgba(0,0,0,0) 75%, rgba(0,0,0,0.0980392) 75%, rgba(0,0,0,0.0980392) 0);background-position: 0 0, 40px 40px;background-origin: padding-box;background-clip: border-box;background-size: 80px 80px;}#testisimo-container { z-index:9999;position:fixed;top:0px;width:260px;right:0px;bottom:0px;background-color:#fff;box-shadow:-4px 0px 15px 0px rgba(50, 50, 50, 0.5); }.testisimo-iframe { border:none;width:100%;height:100%; }",document.body.appendChild(t)},n.prototype.addContainer=function(){var t,e=document.createElement("DIV");e.id="testisimo-container",t=document.createElement("IFRAME"),t.id=this.iframeId,this.toggleClass(t,"testisimo-iframe"),e.appendChild(t),document.body.appendChild(e)},n.prototype.getIframe=function(){var t=document.getElementById(this.iframeId);return t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument},n.prototype.getAppTemplates=function(){var t,e="",n=this.actions;for(t in n)n[t]&&(e+='<script type="text/ng-template" id="'+t+'">'+n[t].optsTemplate+"</script>");return e},n.prototype.addOverlay=function(){var t=document.createElement("DIV");t.id="testisimo-overlay",document.body.appendChild(t),t.addEventListener("click",this.overlayClick)},n.prototype.getOverlay=function(){return document.getElementById("testisimo-overlay")},n.prototype.removeOverlay=function(){var t=this.getOverlay();t.removeEventListener("click",this.overlayClick),t.parentElement.removeChild(t)},n.prototype.overlayClick=function(t){var e=t.x,n=t.y;testisimo.removeOverlay(),setTimeout(function(){var t=document.elementFromPoint(e,n);testisimo.clearClass(testisimo.selectedClass),testisimo.toggleClass(t,testisimo.selectedClass),testisimo.emit("selected",{tagName:t.tagName,attrs:testisimo.getAttributes(t)})},0)},n.prototype.toggleClass=function(t,e){return t.className.indexOf(e)>-1?(t.className=t.className.replace(" "+e,""),!1):(t.className=t.className+" "+e,!0)},n.prototype.clearClass=function(t){var e,n=document.querySelectorAll("."+t);for(e=0;e<n.length;e++)this.toggleClass(n[e],t)},n.prototype.getAttributes=function(t){var e,n,s={},o=t.attributes;if(!o)return{};for(n=0;n<o.length;n++)e=o[n].name,s[e]=o[n].value,"class"===e&&(s[e]=s[e].replace(" testisimo-selected",""));return s},n.prototype.getElementParents=function(t){for(var e=[];t.parentNode;)e.push(t.parentNode),t=t.parentNode;return e},n.prototype.traverseDOM=function(t,e){var n,s;for(e=e||document,n=e.childNodes,s=0;s<n.length;s++)if(t(n[s],this.getAttributes(n[s]))||this.traverseDOM(t,n[s]))return!0},n.prototype.escapeRegExp=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},n.prototype.selectorRegExp=function(t,e){return e=e||"","="===t?new RegExp("^"+this.escapeRegExp(e)+"$","g"):"*"===t?new RegExp(".*"+this.escapeRegExp(e)+".*","g"):"~"===t?new RegExp("([\\s]+|^)("+this.escapeRegExp(e)+")([\\s]+|$)","g"):"|"===t?new RegExp("([-]+|^)("+this.escapeRegExp(e)+")([-]+|$)","g"):"*"===t?new RegExp(".*"+this.escapeRegExp(e)+".*","g"):"^"===t?new RegExp("^"+this.escapeRegExp(e)+".*","g"):"$"===t?new RegExp(".*"+this.escapeRegExp(e)+"$","g"):void 0},n.prototype.searchDOM=function(t,e,n){var s,o,i,r,a,c,l,p,u,d,f=[];t=this.replaceVariables(t||"",n);for(a in e)c=["=","~","|","^","$","*"].indexOf(e[a][0])>-1?e[a][0]:"",l=c?e[a].substring(1):e[a],l=this.replaceVariables(l,n),a=this.replaceVariables(a,n),"innerText"===a||"textContent"===a?l&&(i=this.selectorRegExp(c,l)):"isVisible"===a?r=l:t+="tagName"===a?l:"["+a+("="===c?"":c)+'="'+l+'"]';try{p=document.querySelectorAll(t||"*")}catch(g){p=[]}for(u=0;u<p.length;u++){if(s=this.getAttributes(p[u]),o=p[u].tagName,r||""===r)if("false"===r){if(null!==p[u].offsetParent)continue}else if(null===p[u].offsetParent)continue;i?(d=p[u].innerText||p[u].textContent,d.match(i)&&f.push({elm:p[u],attrs:s,tagName:o})):f.push({elm:p[u],attrs:s,tagName:o})}return f},n.prototype.selectMode=function(){this.addOverlay()},n.prototype.selectElements=function(t,e,n){var s,o;for(this.clearClass(this.selectedClass),s=this.searchDOM(t,e,n),o=0;o<s.length;o++)this.toggleClass(s[o].elm,this.selectedClass);return s},n.prototype.init=function(e,n){function s(){setTimeout(function(){var s,r;for(document.body.style["margin-right"]="250px",o.addStyles(),o.addContainer(),s=o.getIframe(),s.testisimo=o,s.document.open(),s.document.write(o.appHTML()),s.document.close(),r=0;r<window.frames.length;r++)t(window.frames[r]);if(i.length)for(r=0;r<i.length;r++)this.error(i[r].error,i[r].file,i[r].line,i[r].column);e&&setTimeout(e,n||0)},50)}var o=this;"complete"===document.readyState?s():window.addEventListener("onload",s)},n.prototype.sessionStore={get:function(){var t=window.sessionStorage.getItem("testisimo:session");return t?JSON.parse(t):{}},set:function(t){window.sessionStorage.setItem("testisimo:session",JSON.stringify(t))}},n.prototype.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},n.prototype.localStore={cache:null,stringify:function(t){return JSON.stringify(t,function(t,e){return"$"===t[0]?void 0:e})},cleanProjects:function(t){var e,n,s={};for(e in t){s[e]={name:t[e].name,tests:{}};for(n in t[e].tests)s[e].tests[n]={name:t[e].tests[n].name}}return s},getProjects:function(){var t,e,n,s;if(this.cache)return this.cache;t=window.localStorage.getItem("testisimo:projects")||"{}",e=JSON.parse(t);for(n in e){e[n].id=n;for(s in e[n].tests)e[n].tests[s].id=s,e[n].tests[s].projectId=n}return this.cache=e,this.cache},setProject:function(t){var e=this.getProjects();e[t.id]=t,window.localStorage.setItem("testisimo:projects",JSON.stringify(this.cleanProjects(e)))},createProject:function(t){var e=Object.keys(this.getProjects()).length,n={id:testisimo.guid(),name:t||"New Project "+(e?e+1:1)+" (Rename me)",tests:{}};return this.setProject(n),this.createTest(n),n},removeProject:function(t){var e,n;if(t="string"==typeof t?t:t.id,e=this.getProjects(),e[t]){for(n in e[t].tests)window.localStorage.removeItem("testisimo:tests:"+n);delete e[t],window.localStorage.setItem("testisimo:projects",JSON.stringify(this.cleanProjects(e)))}},getCurrentProject:function(){var t=this.getCurrentTest();return this.getProjects()[t.projectId]},getFirstProject:function(){var t=this.getProjects();return t[Object.keys(t)[0]]},exportProjectURL:function(t){var e,n,s;if(t="string"==typeof t?t:t.id,e=this.getProjects()[t],!e)throw new Error('Cannot create export URL, Project with Id "'+t+'" not found');n={id:e.id,name:e.name,tests:{}};for(s in e.tests)n.tests[s]=this.getTest(s);return"data:application/json;charset=utf-8,"+encodeURIComponent(this.stringify(n))},importProject:function(t){var e,n,s,o,i;try{if(e=JSON.parse(t),"[object Object]"!==Object.prototype.toString.call(e))return!1}catch(r){return!1}if("string"!=typeof e.id||"string"!=typeof e.name||"[object Object]"!==Object.prototype.toString.call(e.tests))throw new Error("Cannot import, seems like object is not project");o=e.id,n={},n[o]=e,s=this.cleanProjects(n)[o],s.id=o,this.setProject(s);for(i in s.tests)"[object Object]"===Object.prototype.toString.call(e.tests[i])&&(e.tests[i].id=i,e.tests[i].projectId=o,this.setTest(e.tests[i]));return!0},getFirstTest:function(t){t="string"==typeof t?t:t.id;var e=this.getProjects()[t];if(e)return e.tests[Object.keys(e.tests)[0]]},getCurrentTest:function(){var t,e=JSON.parse(window.localStorage.getItem("testisimo:current")||"{}"),n=this.getProjects(),s=n[e.projectId];return s||(s=this.getFirstProject()||this.createProject()),t=s.tests[e.testId],t||(t=this.getFirstTest(s)||this.createTest(s)),t},setCurrentTest:function(t){window.localStorage.setItem("testisimo:current",JSON.stringify(t?{testId:t.id,projectId:t.projectId}:{}))},getTest:function(t){var e,n;if(t="string"==typeof t?t:t.id,e=window.localStorage.getItem("testisimo:tests:"+t),!e)throw new Error('Cannot load Test "'+t+'", not found');if(e=JSON.parse(e),n=this.getProjects()[e.projectId],!n)throw new Error('Cannot load Test "'+t+'", Project "'+e.projectId+'" not found');return n[e.id]=e,e},setTest:function(t){var e=this.getProjects()[t.projectId];if(!e)throw new Error('Cannot create Test, Project with Id "'+t.projectId+'" not found');e.tests[t.id]=t,this.setProject(e),window.localStorage.setItem("testisimo:tests:"+t.id,this.stringify(t))},createTest:function(t){var e,n,s;if(t="string"==typeof t?t:t.id,e=this.getProjects()[t],!e)throw new Error('Cannot create Test, Project with Id "'+t+'" not found');return n=Object.keys(e.tests).length,s={id:testisimo.guid(),projectId:t,name:"New Test "+(n?n+1:1)+" (Rename me)",steps:[{selector:"",match:{},actions:[]}]},this.setTest(s),s},removeTest:function(t){var e=this.getProjects()[t.projectId];this.setCurrentTest(null),window.localStorage.removeItem("testisimo:tests:"+t.id),e&&e.tests[t.id]&&(delete e.tests[t.id],this.setProject(e),0===Object.keys(e.tests).length&&this.createTest(e))}},n.prototype.forceStop=!1,n.prototype.runningStepIndex=null,n.prototype.runningActionIndex=null,n.prototype.parentTests=[],n.prototype.extractVariableNames=function(t){if(!t)return[];if("string"!=typeof t)return[];var e=[];return t.replace(/\{([^\}\\]+)\}/g,function(t,n){e.push(n)}),e},n.prototype.replaceVariables=function(t,e){return e?t?"string"!=typeof t?"":t.replace(/\{([^\}\\]+)\}/g,function(t,n){return(e[n]||{}).value||""})||"":"":t},n.prototype.tryFindTargets=function(t,e,n,s,o){var i,r=this;return o=o||0,t||e&&0!==Object.keys(e).length?(i=r.searchDOM(t,e,n),i.length||o>r.maxWaitForElementAttempts||r.forceStop?s(i):void setTimeout(function(){r.tryFindTargets(t,e,n,s,o+1)},r.waitForElementInterval)):s([])},n.prototype.executeSteps=function(t,e,n,s){function o(){return r.forceStop?(r.parentTests.length||(r.forceStop=!1),void(n&&n())):(r.runningStepIndex=a.index||s,r.runningActionIndex=c[0].actionIndex,p={step:a.index||s,action:c[0].actionIndex},r.emit("execStart",p),void r.waitForAjaxDone(function(){l?i():r.tryFindTargets(a.selector,a.match,e,function(t){l=t,i()})}))}function i(){c[0].handler(l,c[0].opts,e,function(i){return r.runningStepIndex=null,r.runningActionIndex=null,"error"!==r.forceStop?i?(p={step:a.index||s,action:c[0].actionIndex,message:i.message||i},r.emit("execError",p),n?n(i,"execError",p):null):void setTimeout(function(){p={step:a.index||s,action:c[0].actionIndex},r.emit("execEnd",p),c.shift(),c.length?o():s+1<t.length?r.executeSteps(t,e,n,s+1):n&&n()},(r.minActionWait+(s+1<t.length?r.minStepWait:0))*r.speed):void 0})}var r,a,c,l,p,u,d,f,g;if(s=s||0,r=this,a=t[s],e=e||{},c=[],l=null,u="number"==typeof a.actionIndex&&a.actionIndex>-1?a.actionIndex:0,a){if(r.clearClass(this.selectedClass),0===a.actions.length||u>a.actions.length-1)return s+1<t.length?r.executeSteps(t,e,n,s+1):n?n():null;for(d=u;d<a.actions.length;d++){if(f=a.actions[d].action,!r.actions[f])return r.runningStepIndex=null,r.runningActionIndex=null,g=new Error('Step "'+((a.index||s)+1)+'": Action "'+f+'" not recognized'),p={step:a.index||s,action:d,message:g.message||g},r.emit("execError",p),n?n(g,"execError",p):null;c.push({actionIndex:d,action:f,handler:r.actions[f].handler,opts:a.actions[d].opts})}c.length?o():n&&n()}},n.prototype.error=function(t){var e=this;null!==e.runningStep&&(e.forceStop="error"),e.emit("execError",{step:e.runningStepIndex,action:e.runningActionIndex,message:t.message||t}),e.runningStepIndex=null,e.runningActionIndex=null,e.lastError=t.message||t},n.prototype.actions={},window.Testisimo=n,window.testisimo=new n,window.testisimo.init()}(),Testisimo.prototype.appHTML=function(){return'<!DOCTYPE html><html xmlns:ng="http://angularjs.org" id="ng-app" ng-app="testisimo"><head><link href="'+(this.resources.useCDN?this.resources.fontAwesomeCDN:this.resources.fontAwesome)+'" rel="stylesheet"><link href="'+(this.resources.useCDN?this.resources.bootstrapCDN:this.resources.bootstrap)+'" rel="stylesheet"><script src="'+(this.resources.useCDN?this.resources.angularCDN:this.resources.angular)+'"></script><script type="text/javascript">('+this.appScript.toString()+")();</script>"+this.getAppTemplates()+'<style>body { margin-top:40px; }.footer { height:300px; }.btn-default.btn-circle { border-radius:50% }.btn.btn-light { background-color:transparent;border-color:transparent;color:#fff; }.test-nav { position:fixed;top:0px;left:0px;right:0px;background-color:#fff;z-index:9999;background-color:#000; }.test-nav-header { padding:5px;height:40px; }.step.bg-running { background-color:#0000ff; }.step.bg-error { background-color:#ff0000; }.action.bg-running input,.action.bg-running button { background-color:#ceceff; }.action.bg-error input,.action.bg-error button { background-color:#ffefef; }.step-wrapper { }.step-details { padding:5px;margin-bottom:10px; }.step-details label { font-size:11px;margin:0px; }.step-container { }.step { text-align:center;background-color:#808080;padding:5px;border-bottom:1px solid #000; }.step-options { margin-bottom:10px;padding:0px 5px; }.details-container, .error-container { background-color:#eee;border-bottom-left-radius:4px;border-bottom-right-radius:4px;padding:5px;margin:5px;margin-top:0px; }.error-container { color:#ff0000;background-color:#ffefef;font-size:11px;word-wrap:break-word;white-space:normal;padding-top:12px;margin-top:-7px; }.details { }.alert-danger { color:#ff0000;background-color:#ffefef;word-wrap:break-word;white-space:normal;margin:5px; }.nowrap { text-overflow:ellipsis;white-space:nowrap;display:block;width:100%;overflow:hidden; }.dropdown-item-project { font-size:14px;padding-left:5px !important; }.dropdown-item-test a { font-size:11px }</style></head><body><div ng-controller="TestCtrl"><div class="test-nav"><div class="test-nav-header"><div class="pull-left" style="width:30%"><div class="btn-group btn-group-sm"><button class="btn btn-light" ng-click="execSteps(test.steps)" ng-disabled="test.steps.$status===\'executing\'"><i class="fa" ng-class="{\'fa-play\':test.steps.$status!==\'executing\',\'fa-cog fa-spin\':test.steps.$status===\'executing\'}"></i></button><button class="btn btn-light" ng-click="execStop()"><i class="fa" ng-class="{\'fa-stop\':test.steps.$status!==\'stopping\',\'fa-cog fa-spin\':test.steps.$status===\'stopping\'}"></i></button></div></div><div class="pull-left" style="width:70%"><div class="dropdown"><button class="btn btn-sm btn-default dropdown-toggle" style="width:100%"><span class="nowrap">{{test.name||\'(Empty Name)\'}}</span></button><ul class="dropdown-menu" style="left:-40%;width:140%;"><li ng-repeat-start="(projectId,project) in projects" class="dropdown-item-project" ng-click="$event.stopPropagation()"><strong ng-if="!project.$editName" class="nowrap pull-left" style="width:72%;">&nbsp;{{project.name}}</strong><div class="input-group" ng-if="project.$editName"><input type="text" class="form-control input-sm" ng-model="project.name"><span class="input-group-btn"><button class="btn btn-default btn-sm" ng-click="updateProject(project);project.$editName=false"><i class="fa fa-check"></i></button></span></div><div ng-if="!project.$editName" class="pull-right"><button class="btn btn-default btn-xs btn-circle" style="border:none" ng-click="project.$editName=true"><i class="fa fa-pencil"></i></button><a href="" class="btn btn-default btn-xs btn-circle" style="border:none" ng-click="exportProject($event,project)" download="{{project.name}}.json"><i class="fa fa-download"></i></a><button class="btn btn-default btn-xs btn-circle" style="border:none" ng-click="removeProject(project)"><i class="fa fa-trash"></i></button></div></li><li ng-repeat-end ng-repeat="(testId,projectTest) in project.tests" class="nowrap dropdown-item-test" ng-class="{active:projectTest.id===test.id}"><a href="" ng-click="selectTest(projectTest)">{{projectTest.name||\'(Empty Name)\'}}</a></li><li class="divider"></li><li ng-click="$event.stopPropagation()"><div class="input-group" style="margin:0px 5px;"><input type="text" class="form-control input-sm" ng-model="newProjectName" placeholder="Project Name, or JSON Data"><span class="input-group-btn"><button class="btn btn-default btn-sm" ng-click="createProject(newProjectName);newProjectName=\'\'"><i class="fa fa-plus"></i></button></span></div></li></ul></div></div></div><div class="alert alert-danger" ng-if="error.message"><button class="close" ng-click="error.message=null">&times;</button><strong>Uncaught Error Occured:</strong><br><small>{{error.message}}</small></div></div><div class="step-details"><strong class="nowrap" style="margin-bottom:5px;">{{project.name}}</strong><div class="btn-group btn-group-xs" style="width:100%"><button class="btn btn-default btn-xs" style="width:50%" ng-click="createTest()"><i class="fa fa-plus"></i> Create Test</button><button class="btn btn-default btn-xs" style="width:50%" ng-click="removeTest()"><i class="fa fa-trash"></i> Remove Test</button></div><label>Test Name</label><input type="text" class="form-control input-sm" ng-model="test.name" style="margin-bottom:5px"><label ng-if="objectKeys(test.variables).length">Test Variables (e.g. "{my_var}")</label><div class="clearfix"></div><div ng-repeat="(key,value) in test.variables"><input type="text" class="form-control input-sm pull-left" ng-model="key" placeholder="key" disabled="disabled" style="width:50%"><input type="text" class="form-control input-sm pull-left" ng-model="test.variables[key].value" placeholder="value" style="width:50%"></div><div class="clearfix"></div></div><div ng-repeat="step in test.steps"><div class="step-wrapper"><div class="step-container"><div class="step" ng-class="{\'bg-error\':step.$error,\'bg-running\':step.$executing}""><button class="btn btn-default btn-xs btn-circle text-center pull-left" ng-click="step.$collapsed=!step.$collapsed" ng-style="{\'background-color\':step.$collapsed?\'transparent\':null}"><strong>{{$index+1}}.</strong></button><div class="btn-group btn-group-xs"><button class="btn btn-default btn-xs btn-circle" ng-click="execStep(step)" ng-disabled="step.$executing || !step.actions.length"><i class="fa fa-fw fa-play" ng-class="{\'fa-play\':!step.$executing,\'fa-cog fa-spin\':step.$executing}"></i></button><button class="btn btn-default btn-xs btn-circle" ng-click="execFromStep(step)" ng-disabled="step.$executing || !step.actions.length"><i class="fa fa-fw fa-step-forward"></i></button></div><div class="btn-group btn-group-xs"><button class="btn btn-default btn-xs btn-circle" ng-click="copyStep(step)" ng-disabled="step.$executing"><i class="fa fa-fw fa-copy"></i></button><button class="btn btn-default btn-xs btn-circle" ng-click="test.steps.splice($index+1,0,{actions:[{}] })" ng-disabled="step.$executing"><i class="fa fa-fw fa-plus"></i></button></div><div class="btn-group btn-group-xs"><button class="btn btn-default btn-xs btn-circle" ng-click="moveStep(step, $index-1)" ng-disabled="step.$executing || $first"><i class="fa fa-fw fa-arrow-up"></i></button><button class="btn btn-default btn-xs btn-circle" ng-click="moveStep(step, $index+1)" ng-disabled="step.$executing || $last"><i class="fa fa-fw fa-arrow-down"></i></button></div><button class="btn btn-default btn-xs btn-circle pull-right" ng-click="test.steps.splice($index, 1)" ng-disabled="step.$executing || test.steps.length===1"><i class="fa fa-trash"></i></button></div><div class="step-options" ng-if="!step.$collapsed"><div style="margin-top:2px;"><div class="input-group"><input type="text" class="form-control input-sm" placeholder="selected elements" value="{{selectedElementPreview(step)}}" disabled="disabled"><span class="input-group-btn"><button class="btn btn-default btn-sm" ng-click="expanded={elements:!expanded.elements};step.$selector=step.selector;step.$match=objectToArrayMatch(step.match)" ng-class="{active:expanded.elements}"><i class="fa fa-fw fa-code"></i></button></span></div></div><div class="details-container" ng-if="expanded.elements"><div class="details"><button class="btn btn-default btn-sm" ng-click="step.$selectionMode||selectElements(step)" style="width:50%" ng-class="{active:step.$selectionMode}"><i class="fa fa-crosshairs"></i> Pick</button><button class="btn btn-default btn-sm" ng-click="showSelectedElements(step)" style="width:50%"><i class="fa fa-eye"></i> Show ({{step.$selectedLength||0}})</button><div class="text-center"><small>css selector (and optional attributes)</small><input type="text" class="form-control input-sm" ng-model="step.$selector" placeholder="css selector" ng-change="step.selector=step.$selector"></div><div ng-repeat="attr in step.$match"><input class="form-control input-sm pull-left" ng-model="attr.name" ng-change="updateMatch(step)" style="width:40%" placeholder="attr. name"><div class="dropdown pull-left" style="width:10%;"><button class="btn btn-sm btn-default dropdown-toggle" style="width:100%;padding:2px 0px;"><span style="font-size:16px">{{attr.operator}}</span></button><ul class="dropdown-menu" style="left:-92px;"><li><a href="" ng-click="attr.operator=\'=\';updateMAtch(step)"><strong>=</strong>&nbsp;&nbsp;exact match</a></li><li><a href="" ng-click="attr.operator=\'*\';updateMatch(step)"><strong>*</strong>&nbsp;&nbsp;contains substring</a></li><li><a href="" ng-click="attr.operator=\'~\';updateMatch(step)"><strong>~</strong>&nbsp;&nbsp;is in space separated list</a></li><li><a href="" ng-click="attr.operator=\'|\';updateMatch(step)"><strong>|</strong>&nbsp;&nbsp;is in hyphen separated list</a></li><li><a href="" ng-click="attr.operator=\'^\';updateMatch(step)"><strong>^</strong>&nbsp;&nbsp;starts with</a></li><li><a href="" ng-click="attr.operator=\'$\';updateMatch(step)"><strong>$</strong>&nbsp;&nbsp;ends with</a></li></ul></div><input class="form-control input-sm pull-left" ng-model="attr.value" ng-change="updateMatch(step)" style="width:40%" placeholder="value"><button class="btn btn-sm btn-default" ng-click="step.$match.splice($index,1);updateMatch(step)" style="width:10%;padding:5px 0px;"><i class="fa fa-minus"></i></button></div><div class="text-center"><button class="btn btn-default btn-xs btn-circle" ng-click="step.$match.push({operator:\'=\',value:\'\'});updateMatch(step)"><i class="fa fa-plus"></i></button></div></div></div><div><div ng-repeat-start="action in step.actions track by $index" class="action" style="margin-top:2px;" ng-class="{\'bg-error\':action.$error,\'bg-running\':action.$executing}"><div class="input-group"><input type="text" class="form-control input-sm" placeholder="action details" disabled="disabled" value="{{actionPreview(action)}}"><span class="input-group-btn"><button class="btn btn-default btn-sm" ng-click="action.$expanded=!action.$expanded" ng-class="{active:action.$expanded}"><i class="fa fa-fw fa-cog"></i></button></span></div></div><div ng-repeat-end><div class="details-container" ng-if="action.$expanded"><div class="details"><button class="btn btn-default btn-sm" style="width:25%" ng-click="execStep(step, $index)" ng-disabled="!action.action"><i class="fa fa-play"></i></button><button class="btn btn-default btn-sm" style="width:25%" ng-click="moveAction(step,action,$index-1)" ng-disabled="$first"><i class="fa fa-arrow-up"></i></button><button class="btn btn-default btn-sm" style="width:25%" ng-click="moveAction(step,action,$index+1)" ng-disabled="$last"><i class="fa fa-arrow-down"></i></button><button class="btn btn-default btn-sm" style="width:25%" ng-click="step.actions.splice($index,1)"><i class="fa fa-trash"></i></button><select class="form-control input-sm" placeholder="action" ng-options="id as a.name for (id,a) in availableActions" ng-model="action.action"></select><div ng-include="action.action"></div></div></div><div class="error-container" ng-if="action.$error"><div class="details">{{action.$error}}</div></div></div></div><div class="text-center"><button class="btn btn-default btn-xs btn-circle" ng-click="step.actions.push({$expanded:true})"><i class="fa fa-cog"></i></button></div></div></div></div></div></div><div class="footer"></div><h5 class="text-center">Testisimo &copy; 2016</h5>'},Testisimo.prototype.appScript=function(){angular.module("testisimo",[]).run(["$rootScope","testisimo",function(t){testisimo.addEventListener(function(e,n){t.$broadcast("testisimo:"+e,n)})}]).factory("testisimo",["$window",function(t){return t.testisimo}]).directive("dropdown",["$document",function(t){return{restrict:"C",link:function(e,n){function s(){n.removeClass("open"),t.off("click",s)}var o=angular.element(n[0].querySelector(".dropdown-toggle"));o.on("click",function(e){n.hasClass("open")||(e.stopPropagation(),n.addClass("open"),t.on("click",s))}),e.$on("$destroy",function(){t.off("click",s)})}}}]).directive("stepContainer",["$window",function(t){return{restrict:"C",link:function(e,n){e.$on("testisimo:execError",function(s,o){e.executingSequence&&e.$index===o.step&&t.scrollTo(0,n[0].offsetTop-140)})}}}]).controller("TestCtrl",["$scope","$timeout","$interval","testisimo",function(t,e,n,s){function o(t,e){var n,s,o=[],i={};for(n in t)o.push({key:n,value:t[n][e]});for(o.sort(function(t,e){return t.value<e.value?-1:t.value>e.value?1:0}),s=0;s<o.length;s++)i[o[s].key]=t[o[s].key];return i}function i(t,e,n){var s,o;for(e=e||"name",n=n||"value",s={},o=0;o<t.length;o++)t[o][e]&&"$"!==t[o][e][0]&&(s[t[o][e]]=t[o][n]);return s}function r(t,e,n){var s,o,i;e=e||"name",n=n||"value",s=[];for(o in t)"$"!==o[0]&&(i={},i[e]=o,i[n]=t[o],s.push(i));return s}function a(t,e,n){for(var s=0;s<n.length;s++)e[n[s]]={value:t[n[s]]?t[n[s]].value||"":""}}function c(e){var n,o,i,r,c,l,p=e.variables||{},u={};for(i=0;i<e.steps.length;i++){n=e.steps[i],a(p,u,s.extractVariableNames(n.selector));for(r in n.match)a(p,u,s.extractVariableNames(r)),a(p,u,s.extractVariableNames(n.match[r]));for(c=0;c<n.actions.length;c++)if(o=t.availableActions[n.actions[c].action])if(n.actions[c].opts=n.actions[c].opts||{},"function"==typeof o.optsVariables)a(p,u,o.optsVariables(n.actions[c].opts));else if(o.optsVariables)for(l=0;l<o.optsVariables.length;l++)a(p,u,s.extractVariableNames(n.actions[c].opts[o.optsVariables[l]]))}e.variables=u}var l,p,u,d,f,g,m;t.wasResumed=!1,t.testisimo=s,t.copy=angular.copy,t.merge=angular.merge,t.objectKeys=function(t){return Object.keys(t||{})},t.mergeVariables=function(t,e){defValues={};for(var n in t)defValues[n]={defaultValue:t[n].value};return angular.merge(defValues,e)},t.executingSequence=!1,t.execStep=function(e,n){var o,i;t.executingSequence=!1,o=t.test.steps.indexOf(e),-1!==o&&(i=angular.copy(e),i.index=o,"number"==typeof n&&n>-1&&(i.actionIndex=n,i.actions=i.actions.slice(0,n+1)),s.executeSteps([i],t.test.variables))},t.execFromStep=function(e,n){var o,i;t.executingSequence=!0,o=t.test.steps.indexOf(e),i=angular.copy(t.test.steps),"number"==typeof n&&n>-1&&(i[o].actionIndex=n),o>-1&&s.executeSteps(i,t.test.variables,null,o)},t.execSteps=function(e){t.executingSequence=!0,s.executeSteps(e,t.test.variables)},t.execStop=function(){t.test.steps.$status="stopping",s.forceStop=!0},t.$on("testisimo:execStart",function(n,o){s.sessionStore.set({projectId:t.test.projectId,testId:t.test.id,status:"executing",step:o.step,action:o.action,parentTests:s.parentTests,executingSequence:t.executingSequence,resumed:t.wasResumed}),e(function(){t.test.steps.$status="executing",t.test.steps[o.step].$executing=!0,t.test.steps[o.step].$error=!1;for(var e=0;e<t.test.steps[o.step].actions.length;e++)t.test.steps[o.step].actions[e].$executing=!1,t.test.steps[o.step].actions[e].$error=null;t.test.steps[o.step].actions[o.action].$executing=!0,t.test.steps[o.step].actions[o.action].$error=null})}),t.error={message:s.lastError},t.$on("testisimo:execError",function(n,o){t.wasResumed=!1,s.sessionStore.set({projectId:t.test.projectId,testId:t.test.id,status:"error",step:o.step,action:o.action,parentTests:s.parentTests,resumed:t.wasResumed}),e(function(){return null===o.step?t.error.message=o.message:(t.test.steps.$status="",t.test.steps[o.step].$executing=!1,t.test.steps[o.step].$error=!0,t.test.steps[o.step].actions[o.action].$executing=!1,void(t.test.steps[o.step].actions[o.action].$error=o.message))})}),t.$on("testisimo:execEnd",function(n,o){t.wasResumed=!1,s.sessionStore.set({projectId:t.test.projectId,testId:t.test.id,status:"end",step:o.step,action:o.action,parentTests:s.parentTests,resumed:t.wasResumed}),e(function(){t.test.steps.$status="",t.test.steps[o.step].$executing=!1,t.test.steps[o.step].$error=!1,t.test.steps[o.step].actions[o.action].$executing=!1})}),t.availableActions=o(s.actions,"name"),t.copyStep=function(e){var n,s=t.test.steps.indexOf(e),o=angular.copy(e);for(o.$error=null,n=0;n<o.actions.length;n++)o.actions[n].$error=null;t.test.steps.splice(s+1,0,o)},t.selectElements=function(e){e.$selectionMode=!0,l=function(n){e.$selector=(n.tagName||"").toLowerCase(),e.$match=[];for(var s in n.attrs)e.$match.push({name:s,operator:"=",value:n.attrs[s]});e.$match.push({name:"isVisible",operator:"=",value:"true"}),e.$selectionMode=!1,t.updateMatch(e)},s.selectMode()},t.$on("testisimo:selected",function(t,n){e(function(){l&&l(n),l=null})}),t.showSelectedElements=function(e){e.$selectedLength=s.selectElements(e.$selector,t.arrayToObjectMatch(e.$match),t.test.variables).length},t.arrayToObjectMatch=function(t){var e,n={};for(e=0;e<t.length;e++)t[e].name&&"$"!==t[e].name[0]&&(n[t[e].name]=t[e].operator+t[e].value);return n},t.objectToArrayMatch=function(t){var e,n,s=[];for(e in t)"$"!==e[0]&&(t[e]=t[e]||"",n={},n.name=e,n.operator=["=","~","|","^","$","*"].indexOf(t[e][0])>-1?t[e][0]:"",n.value=t[e].substring(n.operator?1:0),n.operator=n.operator||"=",s.push(n));return s},t.updateMatch=function(e){
e.selector=e.$selector,e.match=t.arrayToObjectMatch(e.$match)},t.arrayToObject=i,t.objectToArray=r,t.selectedElementPreview=function(t){var e,n=t.selector;for(e in t.match)n+=(n?",":"")+e+"="+t.match[e];return n},t.actionPreview=function(e){var n,s,o,i;if(!e.action)return"";if(n=t.availableActions[e.action],n&&"function"==typeof n.optsPreview)return n.optsPreview(e.opts||{});s=!0,o=(n?n.name:e.action)+" (";for(i in e.opts||{})o+=(s?"":",")+i+"="+e.opts[i],s=!1;return o+")"},t.moveStep=function(e,n){var s=t.test.steps.indexOf(e);t.test.steps.splice(s,1),t.test.steps.splice(n,0,e)},t.moveAction=function(t,e,n){var s=t.actions.indexOf(e);t.actions.splice(s,1),t.actions.splice(n,0,e)},t.createTest=function(){t.test=s.localStore.createTest(t.project)},t.removeTest=function(){confirm('Remove Test "'+t.test.name+'" permanently ?')&&(s.localStore.removeTest(t.test),t.test=s.localStore.getCurrentTest(),t.test=s.localStore.getTest(t.test.id),t.project=s.localStore.getProjects()[t.test.projectId])},t.createProject=function(t){s.localStore.importProject(t)||s.localStore.createProject(t)},t.updateProject=function(t){s.localStore.setProject(t)},t.removeProject=function(e){confirm('Remove Project "'+(e||t.project).name+'" permanently ?')&&(s.localStore.removeProject(e||t.project),e&&e.id!==t.project.id||(t.test=s.localStore.getCurrentTest(),t.test=s.localStore.getTest(t.test.id),t.project=s.localStore.getProjects()[t.test.projectId]))},t.setCurrentTest=function(){s.localStore.setCurrentTest(t.test)},t.selectTest=function(e){t.test=s.localStore.getTest(e.id),t.project=s.localStore.getProjects()[e.projectId],t.setCurrentTest()},t.exportProject=function(t,e){var n="A"===t.target.tagName?t.target:t.target.parentNode;n.href=s.localStore.exportProjectURL(e)},t.projects=s.localStore.getProjects(),t.test=s.localStore.getCurrentTest(),t.selectTest(t.test),p=s.sessionStore.get(),"executing"===p.status&&(t.wasResumed=!0,u=t.test.steps[p.step],d=u?u.actions[p.action]:null,f=t.test.steps[p.step+1],s.parentTests=p.parentTests||[],d&&(t.availableActions[d.action]||{}).repeatAfterLocationChange&&p.action--,d?p.executingSequence?t.execFromStep(u,p.action+1):t.execStep(u,p.action+1):f&&p.executingSequence&&t.execFromStep(f,0)),g=null,t.$watch("test",function(t,e){null===g?g=!1:t&&e&&t.id===e.id&&(g=!0)},!0),m=n(function(){g&&(c(t.test),s.localStore.setTest(t.test),g=!1)},1e3),t.$on("$destroy",function(){n.cancel(m)})}])},t=!1,e=!0,function(t){try{return"a"==new t.KeyboardEvent("keyup",{key:"a"}).key}catch(e){return!1}}(this)||void function(){function t(t,e){var n,s,o,i,r,a,c,l,u,d,f,g,m,h,b,y,v,x,w;try{n=document.createEvent("KeyboardEvent")}catch(k){n=document.createEvent("Event")}e=e||{},s={};for(o in F)z(F,o)&&(s[o]=o in e&&void 0!==(i=e[o])?i:F[o]);if(r=s.ctrlKey||!1,a=s.shiftKey||!1,c=s.altKey||!1,l=s.metaKey||!1,u=s.altGraphKey||!1,d=U>3?((r?"Control":"")+(a?" Shift":"")+(c?" Alt":"")+(l?" Meta":"")+(u?" AltGraph":"")).trim():null,f=(s.key||"")+"",g=(s["char"]||"")+"",m=s.location,h=f&&f.charCodeAt(0)||0,b=s.bubbles,y=s.cancelable,v=s.repeat,x=s.locale,w=!1,h=s.keyCode=s.keyCode||h,s.which=s.which||h,p||(n.__keyCode=h,n.__charCode=h,n.__which=h),"initKeyEvent"in n)n.initKeyEvent(t,b,y,j,r,c,a,l,h,h),w=!0;else if("initKeyboardEvent"in n&&W)try{1==U?(n.initKeyboardEvent(t,b,y,j,f,m,r,a,c,l,u),n.__char=g):2==U?n.initKeyboardEvent(t,b,y,j,r,c,a,l,h,h):3==U?(n.initKeyboardEvent(t,b,y,j,f,m,r,c,a,l,u),n.__char=g):4==U?(n.initKeyboardEvent(t,b,y,j,f,m,d,v,x),n.__char=g):5==U?n.initKeyboardEvent(t,b,y,j,g,f,m,d,v,x):n.initKeyboardEvent(t,b,y,j,f,m,d,v,x),w=!0}catch(_){W=!1}w||(n.initEvent(t,b,y,j),n.__char=g,n.__key=f,n.__location=m);for(o in F)z(F,o)&&n[o]!=s[o]&&(delete n[o],O(n,o,{writable:!0,value:s[o]}));return"isTrusted"in n||(n.isTrusted=!1),n}function n(t){return t&&!(t in _)&&"U+"!==t.substring(0,2)}function s(t){var e,n,s,o=t.which||t.keyCode,i=this._this;t.ctrlKey||t.altKey||t.metaKey||(s=f[o])&&0!==s._key||t.__key||t.isTrusted===!1?(e=this._listener,"object"==typeof e&&"handleEvent"in e&&(i=e,e=e.handleEvent),e&&e.apply&&e.apply(i,arguments)):(n=i._||(i._={}),n[D]=o,"keyLocation"in t&&(n._keyLocation=t.keyLocation))}function o(t){var n,s,o,r,a,c=t.which||t.keyCode,d=this,f=d._;t.__stopNow||(f&&D in f?(n=f[D],delete f[D],t.__keyCode=n,(r=g[n])&&v&&r._keyCode&&(n=r._keyCode),"keyLocation"in t&&"_keyLocation"in f&&(delete t.keyLocation,t.keyLocation=f._keyLocation),e&&91>n&&n>64&&c!=n&&!g[n]&&(r=r||(g[n]={}),r._keyCode=n),a=r&&r._key||String.fromCharCode(n).toLowerCase(),t.__key=a,t.__char=String.fromCharCode(c),s=new j.KeyboardEvent("keydown",t),delete s.keyLocation,delete s.__location,u?(delete s.which,O(s,"which",{value:n})):s.__which=n,p&&(delete s.keyCode,O(s,"keyCode",{value:n})),s.__location=l.call(s),i||(r=r||(r=g[c]=g[n]={}),r._char=s["char"],e||(r._key=r._char)),o=!(t.target||d).dispatchEvent(s)):o=!t.ctrlKey&&(f=g[c])&&("object"==typeof f?f._key||"":f).length>1?2:0,o&&(o===!0&&t.preventDefault(),q?t.stopImmediatePropagation():(t.__stopNow=!0,t.stopPropagation())))}var i,r,a,c,l,p,u,d,f,g,m,h,b,y,v,x,w,k,_,j=this,T=0,S=1,C=2,E=3,$=4,I=5,P=j.Event.prototype,N=j.KeyboardEvent&&j.KeyboardEvent.prototype||P,O=Object.defineProperty||function(t,e,n){return"value"in n?void(t[e]=n.value):("get"in n&&t.__defineGetter__(e,n.get),void("set"in n&&t.__defineSetter__(e,n.set)))},L=Object.getOwnPropertyDescriptor,A=function(t,e){return"__lookupGetter__"in t?t.__lookupGetter__(e):L?(L(t,e)||{}).get:void 0},M={keydown:null,keyup:null,keypress:null},V=1,K="_h_9e2",R="_e_8vj",D=K+"__keyCode",F={"char":"",key:"",location:T,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,repeat:!1,locale:"",detail:0,bubbles:!1,cancelable:!1},q="stopImmediatePropagation"in document.createEvent("Event"),H=Array.prototype.slice,J=Function.prototype.bind||function(t){var e=this,n=H.call(arguments,1);return function(){return e.apply(t,n.concat(H.call(arguments)))}},z=J.call(Function.prototype.call,Object.prototype.hasOwnProperty),W=!0,U=function(t){try{var e=t.call(document,"KeyboardEvent");return e.initKeyboardEvent("keyup",!1,!1,j,"+",3,!0,!1,!0,!1,!1),"+"==(e.keyIdentifier||e.key)&&3==(e.keyLocation||e.location)&&(e.ctrlKey?e.altKey?1:3:e.shiftKey?2:4)||"+"==e["char"]&&5||9}catch(n){return 0}}(document.createEvent),Y=function(){try{return this&&new this("keyup",{key:"a","char":"b"})||{}}catch(t){return{}}}.call(j.KeyboardEvent),G={enumerable:!1,configurable:!0,writable:!0};for(L&&(i=A(N,"key")||A(Y,"key"),r=A(N,"char")||A(Y,"char"),a=A(N,"location")||A(Y,"location"),c=A(N,"keyCode")),f={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",21:"KanaMode",22:"HangulMode",23:"JunjaMode",24:"FinalMode",25:"HanjaMode",27:"Esc",28:"Convert",29:"Nonconvert",30:"Accept",31:"ModeChange",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",41:"Select",43:"Execute",44:"PrintScreen",45:"Insert",46:"Del",47:"Help",91:{_key:"OS",_char:!1,_location:S},92:{_key:"OS",_char:!1,_location:C},93:"Menu",106:{_key:"Multiply",_char:"*",_location:E},107:{_key:"Add",_char:"+",_location:E},108:{_key:"Separator",_char:!1,_location:E},109:{_key:"Subtract",_char:"-",_location:E},110:{_key:"Decimal",_char:".",_location:E},111:{_key:"Divide",_char:"/",_location:E},144:{_key:"NumLock",_char:!1,_location:E},145:"ScrollLock",180:"LaunchMail",181:"SelectMedia",182:"LaunchApplication1",183:"LaunchApplication2",224:"Meta",229:"Process",246:"Attn",247:"Crsel",248:"Exsel",249:"EraseEof",251:"Zoom",254:"Clear"},g=e?{186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",226:"\\"}:{},m=j.navigator.userAgent.toLowerCase(),h=!!~(j.navigator.platform+"").indexOf("Mac"),b={},k=999,y=105;y>95;--y)w=y-96,g[w+48]=i?w+"":{_key:w+""},g[y]={_key:w+"",_location:E};if(!i)for(y in g)z(g,y)&&"object"!=typeof g[y]&&(g[y]={_key:g[y]});for(y=135;y>111;--y)f[y]="F"+(y-111);if(j.opera)r||(v=!0,x=!0,f[57351]=f[93],g[187]=g[61]={_key:0,_keyCode:187},g[189]=g[109]={_key:0,_keyCode:189,_location:3});else{for(b.names=m.match(/(mozilla|compatible|chrome|webkit|safari)/gi),y=b.names&&b.names.length||0;y-->0;)b[b.names[y]]=!0;!b.mozilla||b.compatible||b.webkit?b.safari&&!b.chrome||b.chrome:(v=!0,b._version=+(m.match(/firefox\/([0-9]+)/)||[])[1],w=g[61]=g[187],w._keyCode=187,w=g[173]=g[189],w._keyCode=189,w=g[59]=g[186],w._keyCode=186,b._version<15&&(f[107]=f[61],g[109]=g[173]))}_={Escape:null,Win:null,Scroll:null,Apps:null,Delete:null,Window:null,ContextMenu:null,Mul:null},t.DOM_KEY_LOCATION_STANDARD=T,t.DOM_KEY_LOCATION_LEFT=S,t.DOM_KEY_LOCATION_RIGHT=C,t.DOM_KEY_LOCATION_NUMPAD=E,t.DOM_KEY_LOCATION_MOBILE=$,t.DOM_KEY_LOCATION_JOYSTICK=I,t.prototype=N,w=new t("keyup");try{delete w.keyCode,O(w,"keyCode",{writable:!0,value:9}),delete w.which,O(w,"which",{writable:!0,value:9})}catch(B){}u=9===w.which,!(p=9==w.keyCode)&&c?(O(N,"keyCode",{enumerable:!0,configurable:!0,get:function(){return"__keyCode"in this?this.__keyCode:c.call(this)},set:function(t){return this.__keyCode=isNaN(t)?0:t}}),O(N,"charCode",{enumerable:!0,configurable:!0,get:function(){return"__charCode"in this?this.__charCode:c.call(this)},set:function(t){return this.__charCode=isNaN(t)?0:t}})):c=void 0,e&&(d=function(t){var e,n,s,o,i;return t=t||"",t.length>1?t:(e=this.which||this.keyCode,"keypress"==this.type&&(e+=k),n=g[e],s=n&&"object"==typeof n,(o=s?n._key:n)?o:(i=n&&n._keyCode||e>64&&91>e&&e,(i&&String.fromCharCode(i)||t).toLowerCase()))}),O(N,"key",{enumerable:!0,configurable:!0,get:function(){var t,s,o,r,a=this;if(i&&(t=i.call(a),t&&t.length<2||n(t)))return e?d.call(this,t):t;if("__key"in a)return a.__key;if(a.type in M)return s=a.which||a.keyCode,o="keypress"!=a.type,o?"keyIdentifier"in a&&n(a.keyIdentifier)?t=a.keyIdentifier:e&&o&&!(t=f[s])?t=d.call(this,t):(t=t||g[s],r=t&&"object"==typeof t,t=(r?t._key:t)||a["char"]):t=a["char"],G.value=t,O(a,"__key",G),t}}),O(N,"char",{enumerable:!0,configurable:!0,get:function(){var t,e,s,o,i=this;if(i.type in M)return i.ctrlKey||i.altKey||i.metaKey?"":"__char"in i?i.__char:(e="keypress"!=i.type,s=!e&&i.__keyCode||i.which||i.keyCode,e&&(t=f[s])&&"object"!=typeof t?"":(r&&null!==(t=r.call(i))||(t=g[s]||f[s],o=t&&"object"==typeof t,o&&t._char!==!1?o&&void 0!==t._char?t=t._char||"":"keyIdentifier"in i&&n(i.keyIdentifier)?t="":(t=String.fromCharCode(s),e&&!i.shiftKey&&(t=t.toLowerCase())):t=""),G.value=t,O(i,"__char",G),t))}}),l=function(){var t,e,n,s=this;if(a)return a.call(this);if("__location"in s)return s.__location;if(s.type in M)return t=s.which||s.keyCode,e="keypress"!=s.type,"keyLocation"in s?n=s.keyLocation:(n=e&&(f[t]||g[t]),n="object"==typeof n&&n._location||T),G.value=n,O(s,"__location",G),n},O(N,"location",{enumerable:!0,configurable:!0,get:l}),r?document.addEventListener("keydown",function(t){var e,n,s,o=r?r.call(t):t["char"],i=o&&o.charCodeAt(0);i&&!g[i+=k]&&(n=g[i]={},e=t.keyCode,o=(s=g[e])?"object"==typeof s&&s._key||s:String.fromCharCode(e),e>64&&91>e&&e&&(o=o.toLowerCase()),n._key=o)},!0):[(w=j.Document)&&w.prototype||j.document,(w=j.HTMLDocument)&&w.prototype,(w=j.Window)&&w.prototype||j,(w=j.Node)&&w.prototype,(w=j.Element)&&w.prototype].forEach(function(t){if(t&&z(t,"addEventListener")){var e=t.addEventListener,n=t.removeEventListener;e&&(t.addEventListener=function(t,n,i){var r,a,c,l,p=this;if("keydown"===(t+"").toLowerCase()){if(a=R+(i?"-":"")+t,c=a+(n[K]||(n[K]=++V)),l=a+"__count",(r=this._)||(r=this._={}),c in r)return;void 0===r[l]&&e.call(p,"keypress",o,!0),r[l]=(r[l]||0)+1,arguments[1]=r[c]=J.call(s,{_listener:n,_this:this})}return e.apply(p,arguments)},n&&(t.removeEventListener=function(t,e,s){var o,i,r,a,c=this;return"keydown"===(t+"").toLowerCase()&&(i=R+(s?"-":"")+t,r=i+e[K],a=i+"__count",o=c._,r&&o&&o[a]&&(--o[a],(arguments[1]=o[r])&&delete o[r])),n.apply(c,arguments)}))}}),j.KeyboardEvent=t,S=C=E=$=I=L=A=w=Y=t=N=y=P=m=b=h=null}.call(this),Testisimo.prototype.actions.assertInnerText={name:"Assertion - innerText",optsTemplate:'<input type="text" class="form-control input-sm" placeholder="inner Text" ng-model="action.opts.text">',optsPreview:function(t){return this.name+' "'+(t.value||0)+'"'},handler:function(t,e,n,s){return 0===t.length?s(new Error("Target element not found")):void 0}},Testisimo.prototype.actions.click={name:"Click",optsTemplate:"",optsPreview:function(){return this.name},handler:function(t,e,n,s){if(0===t.length)return s(new Error("Target element not found"));for(var o=0;o<t.length;o++)t[o].elm.focus(),t[o].elm.click();s()}},Testisimo.prototype.actions.setValueKeyboard={name:"Keyboard Input",optsTemplate:'<input type="text" class="form-control input-sm" placeholder="text to write" ng-model="action.opts.text">',optsVariables:["text"],optsPreview:function(t){return this.name+' "'+(t.text||"")+'"'},handler:function(t,e,n,s){function o(t,e){return Math.floor(Math.random()*(e-t+1))+t}function i(t,e,n,s){return testisimo.forceStop?n?n():null:(s=s||0,0===s&&(r.focus(),r.value=""),void setTimeout(function(){r.dispatchEvent(new KeyboardEvent("keypress",{bubbles:!0,cancelable:!0,"char":e[s]})),r.value=r.value+e[s];var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),r.dispatchEvent(t),s+1<e.length?i(r,e,n,s+1):n&&n()},o(50,200)*testisimo.speed))}var r,a;return 0===t.length?s(new Error("Target element not found")):t.length>1?s(new Error("Multiple target elements not allowed")):"INPUT"!==t[0].tagName&&"TEXTAREA"!==t[0].tagName?s(new Error("Target must be input or textarea")):["checkbox","radio"].indexOf(t[0].type)>-1?s(new Error("Boolean inputs (checkbox or radio) not allowed")):(r=t[0].elm,a=testisimo.replaceVariables(e.text,n),void i(r,a,s))}},Testisimo.prototype.actions.setLocation={name:"Location Set URL",optsTemplate:'<input type="text" class="form-control input-sm" placeholder="/mypath" ng-model="action.opts.location">',optsVariables:["location"],optsPreview:function(t){return this.name+' "'+(t.text||"")+'"'},handler:function(t,e,n,s){return e.location?(window.location=testisimo.replaceVariables(e.location,n),void s()):s(new Error("Location not set"))}},Testisimo.prototype.actions.reloadLocation={name:"Location Reload",optsTemplate:"",handler:function(t,e,n,s){window.location.reload(),s()}},Testisimo.prototype.actions.runTest={name:" » Run Test",optsTemplate:'<select class="form-control input-sm" placeholder="choose test" style="margin-bottom:5px"ng-options="t.id as t.name disable when t.id===test.id for (id,t) in project.tests" ng-model="action.opts.testId" ng-change="action.opts.testVariables=mergeVariables(testisimo.localStore.getTest(action.opts.testId).variables||{},{})"></select><div class="clearfix"><small><strong>Override Variables</strong></small><button class="btn btn-default btn-xs pull-right" ng-click="action.opts.testVariables=mergeVariables(testisimo.localStore.getTest(action.opts.testId).variables||{},action.opts.testVariables)"><i class="fa fa-refresh"></i> Refresh</button></div><div ng-repeat="(key,value) in action.opts.testVariables" class="clearfix"><input type="text" class="form-control input-sm pull-left" style="width:50%" ng-model="key" disabled="disabled"><input type="text" class="form-control input-sm pull-left" style="width:50%" ng-model="action.opts.testVariables[key].value" placeholder="{{action.opts.testVariables[key].defaultValue}}"></div>',optsVariables:function(t){var e,n=[];t.testVariables=t.testVariables||{};for(e in t.testVariables)t.testVariables[e].value&&(n=n.concat(testisimo.extractVariableNames(t.testVariables[e].value)));return n},optsPreview:function(t){var e=testisimo.localStore.getCurrentProject(),n=(e.tests[t.testId]||{}).name||"";return this.name.substring(1)+' "'+n+'"'},repeatAfterLocationChange:!0,handler:function(t,e,n,s){var o,i,r,a,c,l,p,u,d,f,g,m,h,b;if(!e.testId)return s(new Error("Test Id not defined, choose one in action details, please"));if(o=testisimo.localStore.getCurrentProject(),i=testisimo.localStore.getCurrentTest().id,r=testisimo.localStore.getCurrentTest().name,a=testisimo.localStore.getTest(e.testId),c=testisimo.sessionStore.get().resumed,l=0,p=0,!o.tests[e.testId]||!a)return s(new Error('Test "'+e.testId+'" not found in this project'));for(testisimo.parentTestsLevel=testisimo.parentTestsLevel||0,testisimo.parentTestsLevel>0&&(i=e.testId,r=a.name),u=-1,d={},f=0;f<testisimo.parentTests.length;f++){if(d[testisimo.parentTests[f].id])return s(new Error('Nested Test "'+testisimo.parentTests[f].name+'" duplicity found - preventing infinite loop'));d[testisimo.parentTests[f].id]=!0,testisimo.parentTests[f].id===i&&(u=f)}u>-1?(l=testisimo.parentTests[u].child.step,p=testisimo.parentTests[u].child.action,testisimo.actions[a.steps[l].actions[p].action].repeatAfterLocationChange||p++):(testisimo.parentTests.push({id:i,step:testisimo.runningStepIndex,action:testisimo.runningActionIndex}),u=testisimo.parentTests.length-1),g={},e.testVariables=e.testVariables||{};for(m in e.testVariables)e.testVariables[m].value&&(g[m]={value:testisimo.replaceVariables(e.testVariables[m].value||e.testVariables[m].defaultValue,n)});if(a.variables)for(m in a.variables)g[m]||(g[m]=a.variables[m]);return h=testisimo.eventsInterceptor,testisimo.eventsInterceptor=function(t,e,n){var s,i;if(e&&"number"==typeof e.step&&(testisimo.parentTests[u].child={step:e.step,action:e.action},e.step=testisimo.parentTests[0].step,e.action=testisimo.parentTests[0].action,e.message)){for(s="",i=1;i<testisimo.parentTests.length;i++)s+=o.tests[testisimo.parentTests[i].id].name+(i===testisimo.parentTests.length-1?": ":" --> ");e.message=s+e.message}n(t,e)},b=[].concat(a.steps),b[l]={selector:b[l].selector,match:b[l].match,actions:b[l].actions,actionIndex:p},testisimo.forceStop?s():(testisimo.parentTestsLevel++,void testisimo.executeSteps(b,g,function(t){if(!t){var e=testisimo.parentTests.pop();testisimo.runningStepIndex=e.step,testisimo.runningActionIndex=e.action}testisimo.eventsInterceptor=h,testisimo.parentTestsLevel--,s()},l))}},Testisimo.prototype.actions.wait={name:"Wait (sleep)",optsTemplate:'<input type="number" class="form-control input-sm" ng-model="action.opts.time" placeholder="0 ms">',optsPreview:function(t){return this.name+' "'+(t.time||0)+'"'},handler:function(t,e,n,s){setTimeout(s,e.time||0)}};
//# sourceMappingURL=./testisimo.min.js.map